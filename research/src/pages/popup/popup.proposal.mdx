---
menu: Proposals
name: Popup (Editor's Draft)
path: /components/popup
pathToResearch: /components/popup.research
---

import '../../styles/spec.css'

**Editors:** Melanie Richards (Microsoft)

## HTML Incubation Text

_Target venue: [HTML Living Standard](https://html.spec.whatwg.org/multipage/)_

<dl class="element">
  <dt>
    <span data-x="concept-element-categories">Categories</span>:
  </dt>
  <dd>
    <span>Flow content</span>.
  </dd>
  <dd>
    <span>Sectioning root</span>.
  </dd>
  <dt>
    <span data-x="concept-element-contexts">Contexts in which this element can be used</span>:
  </dt>
  <dd>
    Where <span>flow content</span> is expected.
  </dd>
  <dt>
    <span data-x="concept-element-content-model">Content model</span>:
  </dt>
  <dd>
    <span>Flow content</span>.
  </dd>
  <dt>
    <span data-x="concept-element-attributes">Content attributes</span>:
  </dt>
  <dd>
    <span>Global attributes</span>
  </dd>
  <dd>
    <code>anchor</code> — Creates a relationship with another element, used in an anchored
    positioning scheme
  </dd>
  <dd>
    <code>delegatesfocus</code> — Whether to move focus to the popup's first focusable element
  </dd>
  <dd>
    <code>initiallyopen</code> — Whether the popup is shown upon document load
  </dd>
  <dt>
    <span data-x="concept-element-accessibility-considerations">Accessibility considerations</span>:
  </dt>
  <dd>
    Pending specification in <a href="https://w3c.github.io/html-aria/">ARIA in HTML</a> and{' '}
    <a href="https://w3c.github.io/html-aam/">HTML-AAM</a>.
  </dd>
</dl>

<p class="todo">
  Add IDL to frontmatter (<a href="https://github.com/openui/open-ui/issues/356">#356</a>)
</p>

A `popup` element represents transient application UI that “pops up” in the top layer of a web
document, enabling the user to perform some task in a timely and immediate fashion. `popup` is
similar to the `dialog` element, but is distinguished by its transient nature (“light dismiss”
behaviors) and mutual exclusivity: only one `popup` element may be rendered at a time, with the
exception of nested `popup`s.

## Showing a `popup` element

A `popup` element should not be shown to the user unless:

- The `initiallyopen` attribute is specified
- The `show()` method is invoked
- Or the `popup` element has been invoked via the `popup` attribute.

This requirement may be implemented indirectly through the style layer. For example,
user agents that
[support the suggested default rendering](https://html.spec.whatwg.org/multipage/infrastructure.html#renderingUA)
implement this requirement using the CSS rules described in the
[Rendering section](https://html.spec.whatwg.org/multipage/rendering.html#rendering).

### The `initiallyopen` attribute

The `initiallyopen` attribute is a
[boolean attribute](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#boolean-attribute).
When specified, it indicates that the `popup` element should be shown on document load, such that
the user can interact with it.

**Example:**

```html
<popup initiallyopen></popup>
```

If the `initiallyopen` attribute is specified on a `popup` element _subject_, the user agent must
run [showing a `popup` element steps](#showing-popup-steps).

<p class="question">
  This effectively means the last popup in the DOM order with initiallyopen specified will be the
  popup that "wins". Is that clear enough to implementers? Is that a reasonable behavior?
</p>

### The `show()` method

The `show()` method displays the `popup` element.

**Example:**

```html
<popup id="newFeatureUI">
  <p>
    <strong>New!</strong>
    I’m some sort of educational UI…
  </p>
</popup>

<script>
  if (upsellNewFeature) {
    document.getElementById('newFeatureUI').show()
  }
</script>
```

When `show()` is invoked on a `popup` element _subject_, the user agent must
run [showing a `popup` element steps](#showing-popup-steps).

### The `popup` attribute

The `popup` attribute indicates that a related `popup` element should be shown or hidden as the
user interacts with the element where the `popup` attribute is specified. If the attribute is
specified, the attribute's value must be the ID of a `popup` element in the same
[node document](https://dom.spec.whatwg.org/#concept-node-document).

**Example:** Invoking the `button` element in this example should show/hide the `popup` element,
depending on whether or not the `popup` element is currently shown:

```html
<button id="menuButton" popup="menuPopup">Menu</button>
<popup id="menuPopup" role="menu" anchor="menuButton">
  <!-- Markup for menuitems goes here -->
</popup>
```

The `popup` attribute is supported on a subset of
[interactive elements](https://html.spec.whatwg.org/multipage/interactive-elements.html):

- `button`
- `input` in the `button` state
- `input` in the `text`, `email`, `phone`, or `url` states

Let _activating element_ be the element on which the `popup` attribute is specified. If the
_activating element_ is a `button` element or an `input` element in the `button` state, and the
_activating element_ is activated; OR the _activating element_ is an input in the `text`, `email`,
`phone`, or `url` states and focus is set to the _activating element_, the user agent must run the
following steps:

1. Let _subject_ be the element with the ID referenced by the `popup` attribute specified on the
   _subject_. If the _subject_ is not a `popup` element, then return.
2. If the `open` IDL attribute on the _subject_ is `true`, run
   [hiding a `popup` element steps](#hiding-current-popups).
3. Otherwise, run [showing a `popup` element steps](#showing-popup-steps).

<p class="todo">
  Probably need to specify some way of storing the relationship once subject is activated, for
  purposes of deciding whether to hide a popup.
</p>

<p class="question">
  Should we have a way to suppress these steps upon focus, so that the author can enable the popup
  to be shown upon text entry (or some other logic) instead?
</p>

<h3 id="showing-popup-steps">
  Showing a <code>popup</code> element steps
</h3>

1. Run the [hide currently-shown `popup` elements steps](#hide-current-popups).
2. Add the _subject_ to _subject_'s
   [node document](https://dom.spec.whatwg.org/#concept-node-document)'s
   [top layer](https://fullscreen.spec.whatwg.org/#top-layer), at the top of the stack.
3. Set the `open` IDL attribute on the _subject_ to `true`.

<h4 id="hide-current-popups">
  Hide currently-shown <code>popup</code> elements steps
</h4>

Let _candidate subject_ be the new candidate `popup` element to be shown.
If applicable, let _activating element_ be the element whose `popup` attribute specifies the ID of
the _candidate subject_, and which has been activated by the user.
If applicable, let the _anchor element_ be the element whose ID is referenced by the `anchor`
specified on the _candidate subject_.

Starting at the bottom of the top-layer stack: for each `popup` element which has an `open` IDL
attribute set to `true`, and which is not the _candidate subject_:

1. Let _subject_ be the current `popup` element in the top-layer stack.
2. Walk the DOM to determine if the _subject_ is an ancestor to the _candidate subject_, the
   _activating element_, or the _anchor element_.
3. If the _subject_ is an ancestor, then return.
4. Otherwise, for this _subject_ and any other `popup`s higher in the stack, run the
   [Hiding a `popup` element steps](#hiding-current-popups).

<p class="todo">
  Step #2 probably needs to be more precise, and more specific about Shadow/light DOM
</p>

## Setting focus when the `popup` element is shown

### The `delegatesfocus` attribute

The `delegatesfocus` attribute is a
[boolean attribute](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#boolean-attribute).
When specified, it indicates that when the `popup` element is shown, focus should move to the first
focusable descendent of the `popup` element.

**Example:**

```html
<popup delegatesfocus>
  <p>I am not a focusable element.</p>
  <p>Nor am I.</p>
  <button>I will be focused whenever the popup becomes focused.</button>
</popup>
```

### Focusing steps

The popup [focusing steps](https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps)
for a `popup` element _subject_ are as follows:

1. If the `delegatesfocus` attribute is specified on _subject_, let _control_ be the first focusable
   descendant element of _subject_, in [tree order](https://dom.spec.whatwg.org/#concept-tree-order),
   that is not inert and has the
   [autofocus](https://html.spec.whatwg.org/multipage/interaction.html#attr-fe-autofocus) attribute
   specified.
2. If there is no such descendent, but `delegatesfocus` is specified, let _control_ be _subject_.
3. Otherwise, if the `autofocus` attribute is specified on _subject_, let _control_ be _subject_.
4. Otherwise, return.
5. Run the [focusing steps](https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps)
   for _control_.
6. Let topDocument be the
   [active document](https://html.spec.whatwg.org/multipage/browsers.html#active-document) of
   _control_'s [node document](https://dom.spec.whatwg.org/#concept-node-document)'s
   [browsing context](https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc)'s
   [top-level browsing context](https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context).
7. If control's [node document](https://dom.spec.whatwg.org/#concept-node-document)'s
   [origin](https://dom.spec.whatwg.org/#concept-document-origin) is not the
   [same](https://html.spec.whatwg.org/multipage/origin.html#same-origin) as the
   [origin](https://dom.spec.whatwg.org/#concept-document-origin) of _topDocument_, then return.
8. [Empty](https://infra.spec.whatwg.org/#list-empty) _topDocument_'s
   [autofocus candidates](https://html.spec.whatwg.org/multipage/interaction.html#autofocus-candidates).
9. Set _topDocument_'s
   [autofocus processed flag](https://html.spec.whatwg.org/multipage/interaction.html#autofocus-processed-flag)
   to true.

<p class="note">
  Without the precense of the autofocus or delegatefocus attribute, focus remains on the active
  element. This behavior is to enable scenarios where the popup is used in a composite control. For
  example, a combobox where the user expects their focus to stay in the text input instead of moving
  automatically to the listbox popup as and when it appears.
</p>

<p class="question">
  These focusing steps effectively assert that the delegatesfocus attribute takes precedence over
  the autofocus attribute. Is that the desired behavior?
</p>

## Anchoring a `popup` to another element

Many popups have a visual-logical relationship with another element that may not be a part of the
`popup` element's ancestry chain. For example, a `button` may control a `popup` element, and the
`popup` needs to be positioned with respect to this `button`. Or the `popup` element may simply
_describe_ the `button` element, but similarly needs to be positioned with respect to that `button`
element. The `anchor` attribute indicates this relationship. When specified, the attribute's value
must be the ID of an element in the same
[node document](https://dom.spec.whatwg.org/#concept-node-document) as the `popup` element.

**Example:**

```html
<button id="myButton">Anchor element</button>
<popup open anchor="myButton">
  <p>
    <strong>New!</strong>
    I’m some sort of educational UI…
  </p>
</popup>
```

The target of the `anchor` attribute participates in determining whether a candiate _popup_ element
is "nested" in a currently-shown `popup`; refer to <a href="#hide-current-popups">hide
currently-shown <code>popup</code> elements steps</a>.

<p class="todo">
  Whenever there is a spec to point to for CSS anchored positioning, call out here that the anchor
  attribute is used to help resolve CSS <code>anchor()</code> functions.
</p>

## Hiding a `popup` element

### The `hide()` method

The `hide()` method hides a `popup` element. When `hide()` is invoked, the user agent must run
[hiding a `popup` element steps](#hiding-popup-steps) from the `popup` element _subject_ on which
the method was invoked.

### Light dismissal

When a `popup` element is shown and a light dismiss interaction occurs, the user agent must run
[hiding a `popup` element steps](#hiding-popup-steps) from the `popup` element _subject_.

<p class="todo">
  Land <a href="https://github.com/openui/open-ui/pull/243">#243</a> and link out to this canonical
  definition of light dismissal for consistency. Layout changes to the popup or its anchor element
  are also ground for light dismissal, figure out how to surface this special case. How to handle in
  prose light dismiss behaviors that may dismiss some but not all currently-shown popups?
</p>

<h3 id="hiding-popup-steps">
  Hiding a <code>popup</code> element steps
</h3>

The hiding steps for a `popup` element _subject_ are as follows:

1. Remove the _subject_ from the
   [node document](https://dom.spec.whatwg.org/#concept-node-document)'s
   [top layer](https://fullscreen.spec.whatwg.org/#top-layer).
2. Set the `open` IDL attribute on the _subject_ to `false`.
3. [Queue an element task](https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task)
   on the [user interaction task source](https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source)
   given the _subject_ element to [fire a non-cancelable event](https://dom.spec.whatwg.org/#concept-event-fire)
   named `hide` at _subject_.
